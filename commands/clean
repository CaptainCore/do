# ----------------------------------------------------
#  Cleans up inactive themes.
# ----------------------------------------------------
function clean_themes() {
    # --- Pre-flight checks ---
    if ! command -v wp &>/dev/null; then echo "âŒ Error: WP-CLI not found." >&2; return 1; fi
    if ! wp core is-installed --quiet; then echo "âŒ Error: This does not appear to be a WordPress installation." >&2; return 1; fi

    echo "ðŸ”Ž Finding the latest default WordPress theme to preserve..."
    latest_default_theme=$(wp theme search twenty --field=slug --per-page=1 --quiet --skip-plugins --skip-themes)

    if [ $? -ne 0 ] || [ -z "$latest_default_theme" ]; then
      echo "âŒ Error: Could not determine the latest default theme. Aborting." >&2
      return 1
    fi
    echo "âœ… The latest default theme is '$latest_default_theme'. This will be preserved."

    inactive_themes=($(wp theme list --status=inactive --field=name --skip-plugins --skip-themes))
    if [ ${#inactive_themes[@]} -eq 0 ]; then
      echo "ðŸ‘ No inactive themes found to process. All done!"
      return 0
    fi

    echo "ðŸš€ Processing ${#inactive_themes[@]} inactive themes..."
    for theme in "${inactive_themes[@]}"; do
      # Check if the current inactive theme is the one we want to keep
      if [[ "$theme" == "$latest_default_theme" ]]; then
        echo "âšªï¸ Keeping inactive default theme: $theme"
      else
        echo "âŒ Deleting inactive theme: $theme"
        wp theme delete "$theme"
      fi
    done

    echo "âœ¨ Cleanup complete."
}

# ----------------------------------------------------
#  Analyzes disk usage using rclone.
# ----------------------------------------------------
function clean_disk() {
    echo "ðŸš€ Launching interactive disk usage analysis..."
    if ! setup_rclone; then
        echo "Aborting analysis: rclone setup failed." >&2
        return 1
    fi
    "$RCLONE_CMD" ncdu .
}